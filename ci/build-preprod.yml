build-preprod-api-gateway:
  extends: .build-template
  rules:
    - if: '$CI_COMMIT_BRANCH == "preprod" && $FORCE_BUILD == "1"'
      when: on_success
    - if: '$CI_COMMIT_BRANCH == "preprod"'
      changes: [ "apps/api-gateway/**", "libs/**", "Dockerfile" ]
      when: on_success    
    - when: never
  variables:
    IMAGE_TAG: "preprod"
    APP_NAME: "api-gateway"
    IMAGE_NAME: "api-gateway"

build-preprod-mulesoft-customer-ms:
  extends: .build-template
  rules:
    - if: '$CI_COMMIT_BRANCH == "preprod" && $FORCE_BUILD == "1"'
      when: on_success
    - if: '$CI_COMMIT_BRANCH == "preprod"'
      changes: [ "apps/mulesoft-customer-ms/**", "libs/**", "Dockerfile" ]
      when: on_success    
    - when: never
  variables:
    IMAGE_TAG: "preprod"
    APP_NAME: "mulesoft-customer-ms"
    IMAGE_NAME: "mulesoft-customer-ms"

build-preprod-mulesoft-digital-billing-ms:
  extends: .build-template
  rules:
    - if: '$CI_COMMIT_BRANCH == "preprod" && $FORCE_BUILD == "1"'
      when: on_success
    - if: '$CI_COMMIT_BRANCH == "preprod"'
      changes: [ "apps/mulesoft-digital-billing-ms/**", "libs/**", "Dockerfile" ]
      when: on_success    
    - when: never
  variables:
    IMAGE_TAG: "preprod"
    APP_NAME: "mulesoft-digital-billing-ms"
    IMAGE_NAME: "mulesoft-digital-billing-ms"
